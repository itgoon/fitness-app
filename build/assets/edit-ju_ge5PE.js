import{x as L,C as P,D as $,v as z,y as U,r as x,b as V,j as e,F as H,z as K,E as _,B as y,p as v,T as w,S as A,c as C}from"./index-DCohMUSq.js";import{c as n,b as u,a as S,o as J}from"./index.esm-B_BCm8yh.js";import{u as O,F as Q,R as l}from"./RhfTextField-CQjN9Et2.js";import{u as X,S as T}from"./index-C--RhyKt.js";import{u as Y}from"./useModal-DQiQv9xr.js";import{a as Z,u as ee}from"./membershipService-BT5UrQCW.js";import{C as re}from"./CustomBreadcrumbs-Ynp4_ePu.js";import"./upgradeStorageIllustration-BigDtFz4.js";import{C as se}from"./Container-CRU1XRhF.js";import{C as te}from"./Card-tftieEkb.js";import{T as ie,a as oe,b as o,c as i}from"./TableRow-CAGk89EI.js";import{T as ae}from"./TableBody-CL5-UDjZ.js";import{L as ne}from"./LoadingButton-Dc47B8_Y.js";import"./TextField-D_JdeLxl.js";import"./Select-DHHIZaYz.js";import"./useFormControl-Bc42zwoH.js";function ke(){var g;const k=X(),{id:c}=k,q=L(),{openModal:f,openAlert:I}=Y(),[B,le]=P($.Layout.modalState),{t:r}=z(),m=U(),[a,E]=x.useState(),F=n().shape({id:u().required().positive().integer(),userId:S().required(r("msg.common.error.required",{title:r("ui.member.userId")})),name:n().shape({first:S().required(r("msg.common.error.required",{title:r("ui.member.firstName")}))}),store:n().shape({id:u().required(r("msg.common.error.required",{title:r("ui.store")})).positive().integer()}),duty:n().shape({id:u().moreThan(0,r("msg.common.error.required",{title:r("ui.duty")})).required(r("msg.common.error.required",{title:r("ui.duty")})).integer()}),responsibility:n().shape({id:u().moreThan(0,r("msg.common.error.required",{title:r("ui.responsibility")})).required(r("msg.common.error.required",{title:r("ui.responsibility")})).integer()})}),p=O({resolver:J(F),defaultValues:a}),h=V(),{handleSubmit:N,formState:{isSubmitting:R,errors:M},watch:s,setValue:d}=p;x.useEffect(()=>{if(!c)return m.back();W()},[c]),x.useEffect(()=>{a&&p.reset({...a})},[a]);const W=async()=>{const{data:t,meta:b}=await Z(Number(c));if(b.errCode!==0)return alert(r("exception.unknown.server.error")),m.back();E({...t,password:"",memo:""})},j=N(async t=>{f({type:"reason",data:{title:r("ui.member.modify.reason"),onClickSuccess:async b=>{if(h.onTrue(),(await ee({...t,memo:b})).meta.errCode!==0)return alert(r("exception.unknown.server.error"));I({title:r("msg.common.save.ok"),onClose:()=>{m.back(),h.onFalse()}})}}})}),D=()=>{f({type:"findStore",data:{onClickData:t=>{d("store",t,{shouldValidate:!0})}}})},G=t=>{if(t.key==="Enter"&&!t.shiftKey)return B.open?void 0:(t.preventDefault(),j(t))};return a?e.jsx(Q,{methods:p,onKeyUp:G,children:e.jsxs(se,{maxWidth:q.themeStretch?!1:"lg",children:[e.jsx(re,{heading:r("menu.membership.member"),links:[{name:r("Home")},{name:r("menu.membership"),href:K.user.root},{name:r("menu.membership.member")}],sx:{mb:{xs:3,md:5}}}),e.jsx(te,{children:e.jsx(ie,{sx:{overflow:"unset",p:2},children:e.jsx(_,{children:e.jsx(oe,{sx:{minWidth:700},children:e.jsxs(ae,{children:[e.jsxs(o,{children:[e.jsx(i,{width:70,children:r("ui.member.name")}),e.jsx(i,{sx:{typography:"subtitle2"},children:e.jsxs(y,{display:"flex",flexDirection:"row",rowGap:"8px",columnGap:2,children:[e.jsx(l,{name:"name.last",fullWidth:!1,placeholder:r("ui.common.placeholder.input",{title:r("ui.member.lastName")}),value:s("name.last")?s("name.last"):""}),e.jsx(l,{name:"name.first",placeholder:r("ui.common.placeholder.input",{title:r("ui.member.firstName")}),fullWidth:!1,value:s("name.first")?s("name.first"):""})]})})]}),e.jsxs(o,{children:[e.jsx(i,{width:70,children:r("ui.member.userId")}),e.jsx(i,{sx:{typography:"subtitle2"},children:e.jsx(l,{name:"userId",disabled:!0,value:s("userId")?s("userId"):""})})]}),e.jsxs(o,{children:[e.jsx(i,{width:90,children:r("ui.member.password")}),e.jsx(i,{sx:{typography:"subtitle2"},children:e.jsx(l,{name:"password",type:"password",inputProps:{form:{autocomplete:"off"}},value:s("password")?s("password"):""})})]}),e.jsxs(o,{children:[e.jsx(i,{width:90,children:r("ui.store")}),e.jsx(i,{sx:{typography:"subtitle2"},children:e.jsxs(y,{display:"flex",columnGap:1,children:[e.jsx(l,{name:"store.name",disabled:!0,value:s("store.name")?s("store.name"):""}),e.jsx(v,{variant:"contained",color:"secondary",style:{minWidth:100},onClick:D,children:e.jsx(w,{variant:"subtitle2",children:r("ui.membership.store.button")})})]})})]}),e.jsxs(o,{children:[e.jsx(i,{width:90,children:r("ui.duty")}),e.jsx(i,{sx:{typography:"subtitle2"},children:e.jsx(T,{label:r("ui.duty"),name:"duty.id",value:s("duty.id"),comboType:"membership",comboName:"duty",error:!!((g=M.duty)!=null&&g.id),onChange:t=>{d("duty.id",t.target.value?t.target.value:0),d("responsibility.id",0)}})})]}),e.jsxs(o,{children:[e.jsx(i,{width:90,style:{paddingTop:31},children:r("ui.responsibility")}),e.jsxs(i,{sx:{typography:"subtitle2"},children:[e.jsx(y,{children:e.jsx(T,{label:r("ui.responsibility"),name:"responsibility.id",isNone:!1,value:s("responsibility.id"),disabled:!s("duty.id"),comboType:"membership",comboName:"responsibility",params:{dutyId:s("duty.id"),applicationType:s("responsibility.defaultRole.type.value")?s("responsibility.defaultRole.type.value"):"STUDENT"},onChange:t=>{d("responsibility.id",t.target.value)}})}),e.jsxs(w,{variant:"subtitle2",color:"GrayText",children:[r("ui.responsibility.warning.guide.1"),e.jsx("br",{}),r("ui.responsibility.warning.guide.2")]})]})]})]})})})})}),e.jsxs(A,{justifyContent:"flex-end",direction:"row",spacing:2,sx:{mt:3},children:[e.jsx(ne,{size:"large",variant:"contained",color:"primary",style:{minWidth:100},loading:h.value&&R,onClick:j,startIcon:e.jsx(C,{icon:"ic:round-table-view"}),children:r("ui.common.button.save")}),e.jsx(v,{size:"large",variant:"contained",color:"error",style:{minWidth:100},onClick:()=>m.back(),startIcon:e.jsx(C,{icon:"ic:round-table-view"}),children:r("ui.common.button.cancel")})]})]})}):e.jsx(H,{})}export{ke as default};
