import{v as V,w as _,x as O,y as z,r as l,b as W,N as c,O as H,z as f,j as t,p as K,A as q,c as u,T as G,U as J,S as w,V as y,I as S,E as Q}from"./index-DCohMUSq.js";import{l as X}from"./userService-n3-7vaqn.js";import{u as Z}from"./useDebounce-C458BMjt.js";import{c as ee}from"./common-C3tr0nDT.js";import{C as te}from"./CustomBreadcrumbs-Ynp4_ePu.js";import{u as se,T as ae,a as re}from"./TableNoData-l5xlDQj0.js";import{T as ne}from"./TablePaginationCustom-lHqvqPlH.js";import{T as le}from"./TableSelectedAction-Be4BZUxE.js";import{U as oe}from"./TableFiltersResult-BtUwgqsU.js";import{C as ie}from"./Container-CRU1XRhF.js";import{C as ce}from"./Card-tftieEkb.js";import{T as de,a as me}from"./Tabs-39mxCfHV.js";import{T as ue}from"./TextField-D_JdeLxl.js";import{I as he}from"./InputAdornment-DTQ32jp8.js";import{T as pe,a as fe,b as xe,c as ge}from"./TableRow-CAGk89EI.js";import{T as be}from"./TableBody-CL5-UDjZ.js";import"./TableHead-C-sdwq_b.js";import"./Checkbox-uwB3fCxe.js";import"./SwitchBase-lNz_gExs.js";import"./useFormControl-Bc42zwoH.js";import"./KeyboardArrowRight-BLOc5KWk.js";import"./Select-DHHIZaYz.js";function Ve(){const{t:n}=V(),I=_(),D=O(),x=z(),r=se({defaultOrderBy:"createDate",defaultRowsPerPage:10}),[h,P]=l.useState([]),[g,Y]=l.useState([]),[i,v]=l.useState(0),[M,R]=l.useState(!1),A=W(),[o,d]=l.useState({type:"ALL",searchText:""}),E=[{value:0,label:n("전체")},{value:1,label:n("유효")},{value:3,label:n("만료")}],[k,L]=l.useState(0),B=Z(o.searchText?o.searchText:"",200),b=e=>i-e-r.page*r.rowsPerPage,T=l.useMemo(()=>[{id:"name",label:n("이름"),width:100,align:"center"},{id:"birth",label:n("나이"),width:100,align:"center",Cell:e=>ee(e.birth.toString())},{id:"sex",label:n("성별"),width:100,align:"center",Cell:e=>e.sex===1?"남자":"여자"},{id:"phone",label:n("연락처"),width:150,align:"center"},{id:"registTime",label:n("가입일"),width:150,align:"center",Cell:e=>c(1e3*e.registTime).format("YYYY.MM.DD")},{id:"sessionId",label:n("회원권"),width:150,align:"center",Cell:e=>{const s=g.find(a=>a.playerID===e.playerID);return s?s.title:"-"}},{id:"state",label:n("상태"),width:80,align:"center",Cell:e=>{const s=C(e.playerID);return s?c().isBetween(c(1e3*s.startTime).format("YYYY-MM-DD"),c(1e3*s.endTime).format("YYYY-MM-DD"))?"유효":"만료":"-"}},{id:"status",label:n("기간"),width:230,align:"center",Cell:e=>{const s=C(e.playerID);return s?`${c(1e3*s.startTime).format("YYYY.MM.DD")} ~ ${c(1e3*s.endTime).format("YYYY.MM.DD")}`:"-"}}],[i,r]);l.useEffect(()=>{p()},[r.page,r.rowsPerPage]),l.useEffect(()=>{r.onResetPage(),p()},[o.type,B]);const p=async()=>{const e=await X(o);console.log("res : ",e),P(e.infos),Y(e.membershipInfos),v(e.count),setTimeout(()=>{R(!0)},300)},C=(e=44350)=>{let s=g.filter(a=>a.playerID===e);return s=H.sortBy(s,["state"]),s.length>0?s[0]:void 0},U=()=>{d({type:"ALL",searchText:""})},$=l.useCallback(e=>{x.push(f.user.details(e))},[x]),F=l.useCallback((e,s)=>{L(s);let a="ALL";s===1?a="ACTIVE":s===2?a="PAUSE":s===3&&(a="INACTIVE"),d({...o,type:a})},[]);return t.jsx(t.Fragment,{children:t.jsxs(ie,{maxWidth:D.themeStretch?!1:"lg",children:[t.jsx(te,{heading:"회원목록",links:[{name:n("회원관리")},{name:n("회원목록"),href:f.user.root}],action:t.jsx(K,{component:q,href:f.user.new,variant:"contained",startIcon:t.jsx(u,{icon:"mingcute:add-line"}),style:{height:45},children:t.jsx(G,{variant:"subtitle2",children:n("회원등록")})}),sx:{mb:{xs:3,md:5}}}),t.jsxs(ce,{sx:{minWidth:850},children:[t.jsx(de,{value:k,onChange:F,sx:{px:2.5,boxShadow:`inset 0px -2px 0px 0px ${J(I.palette.grey[500],.08)}`},children:E.map(e=>t.jsx(me,{value:e.value,label:e.label},e.value))}),t.jsx(w,{spacing:2,alignItems:{xs:"flex-end",md:"center"},justifyContent:"flex-end",direction:{xs:"column",md:"row"},sx:{p:2.5,pr:{xs:2.5,md:3}},children:t.jsx(ue,{value:o.searchText,onChange:e=>d({...o,searchText:e.target.value}),placeholder:n("이름 | 연락처"),style:{width:300},InputProps:{startAdornment:t.jsx(he,{position:"start",children:t.jsx(u,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}},"state.searchText")}),t.jsx(oe,{filters:o,onDeleteFilter:e=>{d({...o,[e]:void 0})},onResetFilters:U,results:i,sx:{p:2.5,pt:0}}),t.jsxs(pe,{sx:{position:"relative",overflow:"unset"},children:[t.jsx(le,{dense:r.dense,numSelected:r.selected.length,rowCount:i,onSelectAllRows:e=>{r.onSelectAllRows(e,h.map(s=>String(s.id)))},action:t.jsxs(w,{direction:"row",children:[t.jsx(y,{title:n("새로고침"),children:t.jsx(S,{color:"primary",onClick:()=>p(),children:t.jsx(u,{icon:"material-symbols:refresh"})})}),t.jsx(y,{title:n("엑셀 다운로드"),children:t.jsx(S,{color:"primary",onClick:A.onTrue,children:t.jsx(u,{icon:"mdi:microsoft-excel"})})})]})}),t.jsx(Q,{children:t.jsxs(fe,{size:r.dense?"small":"medium",sx:{},children:[t.jsx(ae,{headLabel:T,rowCount:i,numSelected:r.selected.length}),t.jsxs(be,{children:[h.map((e,s)=>t.jsx(xe,{hover:!0,selected:r.selected.includes(String(e.id)),onClick:()=>$(String(e.id)),style:{cursor:"pointer"},children:T.filter(a=>!(a.id===""&&!a.Cell)).map((a,N)=>{let j=e[a.id]?e[a.id]:"";a.Cell&&(j=a.Cell(e));let m="center";return a.align?a.align==="left"?m="left":a.align==="right"&&(m="right"):m="center",t.jsx(ge,{align:m,children:j},`col_${b(s)}_${N}`)})},`row_${b(s)}`)),M&&t.jsx(re,{notFound:h.length===0})]})]})})]}),t.jsx(ne,{count:i,page:r.page,rowsPerPage:r.rowsPerPage,onPageChange:r.onChangePage,onRowsPerPageChange:r.onChangeRowsPerPage,dense:r.dense,onChangeDense:r.onChangeDense})]})]})})}export{Ve as default};
